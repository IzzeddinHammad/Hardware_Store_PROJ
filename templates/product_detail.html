{% extends 'base.html' %}

{% block content %}

<!-- Ratings Section -->
<hr>
<div class="ratings-section">
    <h3>Customer Ratings</h3>

    <!-- Display messages -->
    {% if messages %}
    <div class="alert-messages">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Display Existing Ratings -->
    {% if product.ratings.all %}
        {% for rating in product.ratings.all %}
        <div class="rating-card" style="border: 1px solid #ddd; padding: 10px; margin: 10px 0;">
            <p>
                <strong>{{ rating.user.username }}</strong>
                <span style="color: gold;">
                    {% with ''|center:rating.stars as range %}
                        {% for _ in range %}â˜…{% endfor %}
                    {% endwith %}
                </span>
                <small>({{ rating.created_at|date:"F j, Y" }})</small>

                {% if rating.user == request.user or request.user.is_staff %}
                <form action="{% url 'remove_rating' rating.id %}" method="post" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-danger ml-2"
                            onclick="return confirm('Are you sure you want to delete this rating?')">
                        Remove
                    </button>
                </form>
                {% endif %}
            </p>

            {% if rating.comment %}
            <div class="comment-box" style="background: #f8f9fa; padding: 8px; border-radius: 4px; margin-top: 8px;">
                <p>{{ rating.comment }}</p>
            </div>
            {% endif %}
        </div>
        {% endfor %}
    {% else %}
        <p>No ratings yet. Be the first to rate!</p>
    {% endif %}

    <!-- Rating Submission Form -->
    <h4>Add Your Rating and Review</h4>
    <form action="{% url 'rate_item' product.id %}" method="post">
        {% csrf_token %}
        <div class="form-group">
            <label>Rating:</label>
            {{ rating_form.stars }}
        </div>
        <div class="form-group">
            <label>Review:</label>
            {{ review_form.comment }}
        </div>
        <button type="submit" class="btn btn-primary">Submit</button>
    </form>
</div>
{% endblock %}